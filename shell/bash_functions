#!/bin/bash
#
# ~/.bash_functions

#######################################
# Lists all defined functions.
#######################################
list_functions() {
  declare -F | grep -v '\-f _'
}

#######################################
# Creates new directories and then enters the last one.
# Arguments:
#   Directories to create.
# Returns:
#   0 on success, non-zero on error.
#######################################
mkd() {
  mkdir -p "$@" && cd "$_" || exit 1
}

#######################################
# Searches for text within Bash history.
# Arguments:
#   Text to search.
# Outputs:
#   Writes search results to stdout.
#######################################
qh() {
  grep \
    --color=always \
    --ignore-case \
    "$*" "${HISTFILE}" | less -RX
}

#######################################
# Searches for text within the current directory.
# Arguments:
#   Text to search.
# Outputs:
#   Writes search results to stdout.
#######################################
qt() {
  grep \
    --color=always \
    --ignore-case \
    --recursive \
    --exclude-dir={.git,node_modules} \
    "$*" "${PWD}" | less -RX
}

#######################################
# Converts text files with DOS line endings to Unix line endings.
# Arguments:
#   Files to convert.
# Inputs:
#   Reads text from stdin if no argument is given.
# Outputs:
#   Writes converted text to stdout.
#######################################
crlf2lf() {
  cat "$@" <&0 | sed -e 's/\r$//g'
}

#######################################
# Converts text files with Unix line endings to DOS line endings.
# Arguments:
#   Files to convert.
# Inputs:
#   Reads text from stdin if no argument is given.
# Outputs:
#   Writes converted text to stdout.
#######################################
lf2crlf() {
  cat "$@" <&0 | sed -e 's/$/\r/g'
}

#######################################
# Runs `git pull` on every directory within the current directory.
#######################################
git-updateall() {
  find . \
    -maxdepth 1 \
    ! -path . \
    -type d \
    -print \
    -execdir git --git-dir={}/.git --work-tree="${PWD}/{}" pull \;
}
